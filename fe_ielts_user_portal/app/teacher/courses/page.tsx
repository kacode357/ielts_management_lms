"use client";
import{useEffect,useState,useMemo}from"react";import{useRouter}from"next/navigation";import{cookieUtils}from"@/utils/cookie";import{User}from"@/types/auth";import Header from"@/components/Header";import{useMounted}from"@/hooks";import{BookOpen,Users,Calendar}from"lucide-react";import axiosInstance from"@/config/axios.config";import{Course}from"@/types/course";import toast from"react-hot-toast";export default function CoursesPage(){const router=useRouter();const mounted=useMounted();const user=useMemo(()=>{if(!mounted)return null;return cookieUtils.getJSON<User>("__usr_x")},[mounted]);const[courses,setCourses]=useState<Course[]>([]);const[isLoading,setIsLoading]=useState(true);useEffect(()=>{if(mounted&&!user){router.push("/login")}},[mounted,user,router]);useEffect(()=>{const fetchCourses=async()=>{if(!user)return;try{setIsLoading(true);const response=await axiosInstance.get("/courses");if(response.data.success){setCourses(response.data.data.courses)}}catch(error){console.error("Fetch courses error:",error);toast.error("Failed to load courses")}finally{setIsLoading(false)}};fetchCourses()},[user]);if(!mounted||!user){return(<div className="min-h-screen flex items-center justify-center bg-gray-50"><div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div></div>)}return(<><Header/><div className="min-h-screen bg-gray-50"><div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><h1 className="text-3xl font-bold text-gray-900 mb-6">All Courses</h1>{isLoading&&(<div className="flex justify-center items-center py-12"><div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div></div>)}{!isLoading&&(<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">{courses.map((course)=>(<div key={course._id}className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow cursor-pointer"onClick={()=>router.push(`/teacher/courses/${course._id}`)}><div className="flex items-center gap-3 mb-4"><div className="w-12 h-12 rounded-xl bg-linear-to-br from-blue-500 to-indigo-600 flex items-center justify-center"><BookOpen className="w-6 h-6 text-white"/></div><div className="flex-1"><h3 className="font-bold text-gray-900">{course.name}</h3><p className="text-xs text-gray-500">{course.code}</p></div></div><p className="text-sm text-gray-600 mb-4 line-clamp-2">{course.description}</p><div className="flex items-center gap-4 text-xs text-gray-500"><span className="flex items-center gap-1"><Users className="w-3 h-3"/>{course.currentStudents}/{course.maxStudents}</span><span className="flex items-center gap-1"><Calendar className="w-3 h-3"/>{course.level}</span></div></div>))}</div>)}</div></div></>)}

